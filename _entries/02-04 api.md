---
sectionid: ratingsapi
sectionclass: h2
title: ratings APIのデプロイ
parent-id: lab-ratingapp
---

The `rating-api` is a NodeJS application that connects to mongoDB to retrieve and rate items. Below are some of the details that you'll need to deploy this.
サンプルのrating-apiは、mongoDBに接続してアイテムを取得および評価するNodeJSアプリケーションです。これを展開するために必要な情報を以下に示します。

- GitHub: <https://github.com/microsoft/rating-api>
- コンテナは8080ポートを使用します
- MongoDBへの接続は、環境変数`MONGODB_URI`を使用します。 

### OpenShift CLIを使用してデプロイします

> **Note** You're going to be using [source-to-image (S2I)](#source-to-image-s2i) as a build strategy.

{% collapsible %}

```sh
./oc new-app https://github.com/microsoft/rating-api
```

![Create rating-api using oc cli](media/oc-newapp-ratingapi.png)

{% endcollapsible %}

### 必要な環境変数を設定します

{% collapsible %}

Create the `MONGODB_URI` environment variable. This URI should look like `mongodb://[username]:[password]@[endpoint]:27017/ratingsdb`. You'll need to replace the `[usernaame]` and `[password]` with the ones you used when creating the database. You'll also need to replace the `[endpoint]` with the hostname acquired in the previous step
環境変数 `MONGODB_URI` を作成します。このURIは次のようになります。
mongodb://[username]:[password]@[endpoint]:27017/ratingsdb

データベースを作成したときに使用したときの`usernaame` `password` `endpoint` に値を書き換えます。

完了したら[Save]をクリックします。

![Create a MONGODB_URI environment variable](media/rating-api-envvars.png)

{% endcollapsible %}

### サービスの稼働確認

{% collapsible %}

`rating-api` Deploymentのログに移動すると、コードがmongoDBに正常に接続できることを確認するログメッセージが表示されます。

![Verify mongoDB connection](media/rating-api-working.png)

{% endcollapsible %}

### `rating-api` サービスのホスト名を取得する

{% collapsible %}

`rating-api` サービスを確認します。

```sh
./oc get svc rating-api
```

サービスはポート8080のDNS名でアクセスできるようになります。
rating-api.workshop.svc.cluster.local:8080
この `[service name].[project name].svc.cluster.local` はクラスタ内でのみ名前解決されます。

{% endcollapsible %}

> **Resources**
> * <https://docs.openshift.com/aro/creating_images/s2i.html>
> * <https://docs.openshift.com/aro/using_images/db_images/mongodb.html#running-mongodb-commands-in-containers>